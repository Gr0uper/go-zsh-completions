#compdef gotests

_gotests() {

  __go_packages() {
    local gopaths
    declare -a gopaths
    gopaths=("${(s/:/)$(go env GOPATH)}")
    gopaths+=("$(go env GOROOT)")
    for p in $gopaths; do
      _alternative ':go files:_files -W "$p/src" -g "*.go"'
    done
  }

  case ${words[1]} in
    gotests)
      _arguments \
        '-all[generate tests for all functions and methods]' \
        "-excl[generate tests for functions and methods that don't match]:function (regexp)" \
        '-exported[generate tests for exported functions and methods]' \
        '-i[print test inputs in error messages]' \
        '-only[generate tests for functions and methods that match only]:function (regexp)' \
        '-w[write output to (test) files instead of stdout]' \
        '*:importpaths:__go_packages'
      ;;
  esac
}


_gotests

# vim:filetype=zsh:softtabstop=4:shiftwidth=4:tabstop=4
